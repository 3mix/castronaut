#!/usr/bin/env ruby

require File.expand_path(File.join(File.dirname(__FILE__), '..', 'castronaut'))
$LOAD_PATH.unshift(File.dirname(__FILE__) + '/../vendor/sinatra/lib')
$LOAD_PATH.unshift(File.dirname(__FILE__) + '/../vendor/rack/lib')

require 'rack'
require 'sinatra'
require 'optparse'

options = {}
OptionParser.new do |opts|
  opts.banner = "Usage: castronaut -C /path/to/config/file"

  opts.on("-C", "--config", "Config File") do |c|
    options[:config_file] = ARGV[0]
  end
end.parse!

if options[:config_file]
  $cas_config ||= Castronaut::Configuration.new(options[:config_file])
else
  $cas_config ||= Castronaut::Configuration.new('./castronaut.example.yml')
end

Sinatra::Application.default_options.merge!(
  :env => $cas_config.environment.to_sym,
  :run => true,
  :raise_errors => true,
  :logging => true
)

$cas_config.logger.debug("Sinatra - Loading app/config.rb")
load File.expand_path(File.join(File.dirname(__FILE__), '..', 'app', 'config.rb'))

$cas_config.logger.debug("Sinatra - Loading app/application.rb")
load File.expand_path(File.join(File.dirname(__FILE__), '..', 'app', 'controllers', 'application.rb'))
